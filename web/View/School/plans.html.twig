{% extends './base.html.twig' %}

{% block title %}eDziennik AMN - plan lekcji{% endblock %}

{% block head %}
    <link href="{{ url('template') }}/css/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
{% endblock %}


{% block content %}

    {% if info != 'brak' %}
        {% if info.col == 'red' %}               
            <div class="alert alert-danger" role="alert">
            {% else %}
                <div class="alert alert-success" role="alert">
                {% endif %}

                {{ info.inf }}
            </div>
        {% endif %}


        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
                    Szkoła
                    <small>Control panel</small>
                </h1>
                <ol class="breadcrumb">
                    <li><a href="{{ url('Home/index') }}"><i class="fa fa-dashboard"></i> Home</a></li>
                    <li><a href="{{ url('School/index') }}"><i class="fa"></i>Szkoła</a></li>
                    <li class="active">Plan lekcji</li>
                </ol>
            </section>

            <!-- Main content -->
            <section class="content">

                <!-- TO DO List -->
                <div class="box box-primary">
                    <div class="box-header">
                        <i class="ion ion-clipboard"></i>
                        <h3 class="box-title">Plan lekcji</h3>
                    </div><!-- /.box-header -->

                    <div class="box-body">
                        {% for c in classes %}                        
                            <h4>Klasa {{ c.name }}</h4>
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Poniedziałek</th>
                                        <th>Wtorek</th>
                                        <th>Środa</th>
                                        <th>Czwartek</th>
                                        <th>Piątek</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in range(1, 8) %}
                                        <tr>
                                            <td width="5%">{{ i }}</td>
                                            {% for d in range(1, 5) %}
                                                <td width="19%">
                                                    <div class="pull-left">
                                                        {% for data in plan[c.name][i][d] %}
                                                            <p>
                                                                {{ data.subject.subject }}{% if data.classroom %} s. {{ data.classroom.name }}{% endif %}
                                                                {% if data.group %}<br />[{{ data.group.name }}]{% endif %}
                                                                <br /><i>{{ data.teacher.givenName }} {{ data.teacher.familyName }}</i>
                                                            </p>
                                                        {% endfor %}
                                                    </div>

                                                    <a href="#" class="pull-right" data-toggle="modal" data-target="#addLesson" data-whatever="{{ c.id }}|{{ d }}|{{ i }}"><i class="fa fa-plus"></i></a>


                                                </td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </tbody>

                            </table>
                        {% endfor %}



                    </div><!-- /.box-body -->

                    <div class="box-footer clearfix no-border">
                        <a href="#" class="btn btn-default pull-right"><i class="fa fa-plus"></i> Edytuj</a>
                    </div>
                </div>

            </section>
        </div>
    </section>
</div>







<div class="modal fade" id="addLesson" tabindex="-1" role="dialog" aria-labelledby="addLessonLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addLessonLabel">Nowa lekcja</h4>
            </div>
            <div class="modal-body">
                <form method="POST" id="ajaxform" action="{{ url('School/plans', {'action': 'add'}) }}">
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">Przedmiot:</label>
                        <select name="subject" class="form-control">
                            {% for s in subjects %}
                                <option value="{{ s.id }}">{{ s.subject }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="recipient-name" class="control-label">Nauczyciel:</label>
                        <select name="teacher" class="form-control">
                            {% for t in teachers %}
                                <option value="{{ t.id }}">{{ t.givenName }} {{ t.familyName }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="recipient-name" class="control-label">Grupa:</label>
                        <select name="group" class="form-control">
                            <option value="0">-brak-</option>
                            {% for gr in groups %}
                                <option value="{{ gr.id }}">
                                    {% if gr.level > 0 %}
                                        {% for i in range(1, gr.level) %}&nbsp;&nbsp;&nbsp;{% endfor %}
                                    {% endif %}
                                    {{ gr.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="recipient-name" class="control-label">Sala:</label>
                        <select name="classroom" class="form-control">
                            {% for c in classrooms %}
                                <option value="0">-brak-</option>
                                <option value="{{ c.id }}">{{ c.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">Obowiązuje od - do:</label>
                        <div class="input-group">
                            <div class="input-group-addon">
                                <i class="fa fa-calendar"></i>
                            </div>
                            <input type="text" name="dateRange" class="form-control pull-right" id="daterange" value="" />
                        </div>
                    </div>

                    <input type="hidden" name="class" id="class-input" />
                    <input type="hidden" name="hour" id="hour-input" />
                    <input type="hidden" name="day" id="day-input" />

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Zamknij</button>
                        <input type="submit" name="save" class="btn btn-primary" value="Zapisz" />
                    </div>
                </form>
            </div>

            <!--div id="result">s\res</div-->
        </div>
    </div>
</div>
<script type="text/javascript" >

    $('#addLesson').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Button that triggered the modal
        var recipient = button.data('whatever'); // Extract info from data-* attributes
        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this);
        //modal.find('.modal-title').text('Lekcja ' + recipient);
        //modal.find('.modal-body input').val(recipient)
        var res = recipient.split('|');
        modal.find('#class-input').val(res[0]);
        modal.find('#day-input').val(res[1]);
        modal.find('#hour-input').val(res[2]);
    });

//callback handler for form submit
    /* $("#ajaxform").submit(function (e)
     {
     e.preventDefault(); //STOP default action
     
     //var postData = $(this).serializeArray();
     var term = $form.find( "input[name='save']" ).val(),
     var formURL = $(this).attr("action");
     var postData = $( ":input" ).serializeArray();
     var posting = $.post(formURL, { save: term });
     
     // Put the results in a div
     posting.done(function (data) {
     //var content = $(data).find("#content");
     $("#result").empty().append(data);
     });
     });*/

</script>


<script src="{{ url('template') }}/js/daterangepicker.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {

        //Date range picker
        $('#daterange').daterangepicker({
            format: 'YYYY-MM-DD',
            locale: {
                applyLabel: 'Zapisz',
                cancelLabel: 'Anuluj',
                fromLabel: 'Od',
                toLabel: 'Do',
                customRangeLabel: 'Własne',
                daysOfWeek: ['Nd', 'Po', 'Wt', 'Śr', 'Czw', 'Pt', 'So'],
                monthNames: ['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'],
                firstDay: 1
            }
        });

        //Timepicker
        $(".timepicker").timepicker({
            showInputs: false
        });
    });
</script>


{% endblock %}
